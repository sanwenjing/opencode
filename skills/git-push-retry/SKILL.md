---
name: git-push-retry
description: "自动重试git push命令直到成功的工具。当git push因网络问题、认证失败或远程仓库暂时不可用时，自动持续重试直到推送成功。适用于网络不稳定环境、大文件推送或需要确保推送完成的场景。支持自定义重试间隔、最大重试次数，提供详细的重试日志和状态反馈"
license: 专有。LICENSE.txt 包含完整条款
---

## Git Push Retry - Git推送自动重试工具

### 描述
这是一个专门用于解决git push失败的自动化工具。在网络不稳定、远程仓库暂时不可用或需要持续尝试推送的场景下，该工具会持续重试git push命令，直到推送成功或达到最大重试次数。

### 目录结构
```
git-push-retry/
├── SKILL.md                    # 技能主配置文件
└── scripts/                    # 脚本目录
    └── git_push_retry.py      # 自动重试脚本（位于 scripts/git_push_retry.py）
```

### 自动执行说明
**重要**: 当用户调用此技能时，应立即执行 git push 重试操作，无需询问确认。

执行命令：
```bash
python C:\Users\Administrator\.config\opencode\skills\git-push-retry\scripts\git_push_retry.py
```

### 脚本索引
**编码声明**: 本技能所有脚本默认使用UTF-8编码，Windows系统下已配置UTF-8控制台输出。

| 脚本名称 | 脚本路径 | 功能描述 | 调用方式 |
|---------|---------|---------|---------|
| git_push_retry.py | scripts/git_push_retry.py | 自动重试git push直到成功 | 自动执行 |

### 核心功能

#### 1. 自动重试机制
- 持续执行git push命令
- 失败时自动等待后重试
- 成功时立即退出并报告
- 智能错误处理，区分不同类型的失败

#### 2. 灵活配置
- 可设置最大重试次数（默认无限重试）
- 可自定义重试间隔时间（默认5秒）
- 支持静默模式减少输出
- 支持详细日志模式

#### 3. 友好输出
- 显示当前工作目录
- 显示每次重试的时间和次数
- 简洁的错误摘要（避免刷屏）
- 成功时显示总重试次数

#### 4. 安全机制
- 支持Ctrl+C中断
- 验证git命令存在性
- 参数合法性检查
- 异常捕获和处理

### 支持的失败场景

- **网络问题**: 连接超时、DNS解析失败
- **认证问题**: 凭据过期、权限不足
- **服务器问题**: 远程仓库暂时不可用
- **并发冲突**: 其他推送正在进行

### 使用方法

#### 基本用法（无限重试）
```bash
# 在包含.git目录的项目中运行
python scripts/git_push_retry.py
```
- 默认每5秒重试一次
- 无限重试直到成功
- 显示详细进度信息

#### 设置最大重试次数
```bash
python scripts/git_push_retry.py -m 10
```
- 最多重试10次
- 超过后自动停止并报告失败

#### 设置重试间隔
```bash
python scripts/git_push_retry.py -d 3
```
- 每3秒重试一次
- 适用于需要快速重试的场景

#### 静默模式
```bash
python scripts/git_push_retry.py -q
```
- 只显示成功或最终失败信息
- 适用于后台运行或日志记录

#### 组合使用
```bash
python scripts/git_push_retry.py -m 20 -d 2 -q
```
- 最多重试20次
- 每2秒重试一次
- 静默模式运行

### 使用流程

1. **进入项目目录**
   ```bash
   cd /path/to/your/git/repo
   ```

2. **运行重试脚本**
   ```bash
   python scripts/git_push_retry.py
   ```

3. **等待完成**
   - 脚本会自动显示每次重试状态
   - 推送成功后自动退出
   - 可按Ctrl+C随时中断

### 输出示例

#### 成功场景
```
============================================================
         Git Push 自动重试工具
============================================================
开始时间: 2026-02-02 14:30:00
工作目录: /path/to/project
重试间隔: 5秒
最大重试次数: 无限重试
============================================================

[1] 14:30:00 - 正在尝试 git push...
  ✗ 失败 (返回码: 128)
  错误: fatal: unable to access 'https://github.com/...': Connection timed out
  等待 5 秒后重试...

[2] 14:30:05 - 正在尝试 git push...
  ✗ 失败 (返回码: 128)
  错误: fatal: unable to access 'https://github.com/...': Connection timed out
  等待 5 秒后重试...

[3] 14:30:10 - 正在尝试 git push...

✓ Git push 成功！
  成功时间: 2026-02-02 14:30:10
  总重试次数: 3

输出信息:
Enumerating objects: 15, done.
Counting objects: 100% (15/15), done.
...
```

#### 中断场景
```
[15] 14:32:30 - 正在尝试 git push...
  ✗ 失败 (返回码: 128)
  错误: fatal: unable to access...
  等待 5 秒后重试...

^C

⚠ 用户中断，共重试 15 次
```

### 参数说明

| 参数 | 短选项 | 默认值 | 说明 |
|------|--------|--------|------|
| --max-retries | -m | None | 最大重试次数，不指定则无限重试 |
| --delay | -d | 5 | 重试间隔时间（秒） |
| --quiet | -q | False | 静默模式，减少输出信息 |

### 技术优势

- **智能重试**: 自动识别失败原因，无需人工干预
- **非侵入式**: 不影响正常git工作流程
- **资源友好**: 低CPU占用，仅在需要时执行
- **跨平台**: 支持Windows、macOS、Linux
- **日志完整**: 记录每次尝试的时间和结果

### 适用场景

1. **网络不稳定**: 移动办公、VPN连接、公共WiFi
2. **大文件推送**: 需要长时间上传，网络可能中断
3. **持续集成**: 自动化脚本中确保推送成功
4. **远程协作**: 跨国团队，网络延迟高
5. **后台任务**: 设置为后台运行，稍后检查状态

### 注意事项

- 确保在包含.git目录的项目根目录下运行
- 需要安装Git并添加到系统PATH
- 如果认证失败，请先手动解决认证问题
- 建议设置合理的最大重试次数，避免无限循环
- 静默模式下注意检查最终退出状态码

### 退出状态码

- **0**: 推送成功
- **1**: 推送失败（达到最大重试次数或发生错误）
- **130**: 用户中断（Ctrl+C）

### 兼容性

- Windows 7/8/10/11
- macOS 10.12+
- Linux (Ubuntu, CentOS等)
- Python 3.6+
- Git 2.0+

### 依赖要求

- Python 3.6 或更高版本
- Git 已安装并配置
- 无第三方Python库依赖（仅使用标准库）

### 故障排除

#### 问题：提示"未找到git命令"
**解决**: 确保Git已安装并添加到系统PATH环境变量

#### 问题：一直提示认证失败
**解决**: 先运行`git push`手动解决认证问题，然后使用本工具

#### 问题：网络恢复后仍未成功
**解决**: 检查远程仓库URL是否正确：`git remote -v`

#### 问题：推送成功但未显示输出
**解决**: 使用详细模式运行，不带`-q`参数

### 高级用法

#### 与git commit组合使用
```bash
# 提交并持续推送直到成功
git commit -m "更新" && python scripts/git_push_retry.py
```

#### 后台运行（Linux/macOS）
```bash
python scripts/git_push_retry.py -q &
# 稍后检查: wait
```

#### 设置别名（推荐）
在~/.bashrc或~/.zshrc中添加：
```bash
alias gpr='python /path/to/git-push-retry/scripts/git_push_retry.py'
```

### 类别
开发工具、版本控制、Git工具、自动化工具
